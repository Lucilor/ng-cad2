<div class="content flex-row flex-110">
  <div class="rect-container flex-column">
    <div class="btn-group">
      <button mat-raised-button color="primary" (click)="submit()">提交</button>
      <ng-container *ngIf="!production">
        <button mat-raised-button color="primary" (click)="generateRects(true)">重新生成矩形</button>
        <div>颜色范围</div>
        <div class="flex-row" style="height: 64px; align-items: flex-end">
          <mat-slider [min]="0" [max]="255" discrete style="width: 300px">
            <input [(ngModel)]="rgbMin" matSliderStartThumb />
            <input [(ngModel)]="rgbMax" matSliderEndThumb />
          </mat-slider>
        </div>
      </ng-container>
    </div>
    <div #rectOuter class="rect-outer flex-110">
      <div class="rects">
        <div
          class="rect flex-row"
          *ngFor="let info of rectInfosRelative"
          [ngClass]="{'is-buju': info.raw.isBuju, active: info.active}"
          [ngStyle]="getRectStyle(info)"
          (click)="onRectClick(info)"
        >
          <div class="title">{{ info.raw.mingzi }}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="fenlei-container flex-column flex-110" cdkDropListGroup>
    <div class="btn-group">
      <mat-form-field>
        <mat-label>名字</mat-label>
        <input type="text" matInput *ngIf="currRectInfo; else emptyInput" [(ngModel)]="currRectInfo.raw.mingzi" autocomplete="off" />
        <ng-template #emptyInput><input matInput readonly /></ng-template>
      </mat-form-field>
    </div>
    <div class="fenlei-lists flex-row flex-110">
      <div class="flex-column flex-110">
        <div class="title">可选模块分类</div>
        <ng-template *ngTemplateOutlet="fenleiListT; context: {$implicit: fenleisSelected, class: 'selected'}"></ng-template>
      </div>
      <div class="flex-column flex-110">
        <div class="title">备选模块分类</div>
        <ng-template *ngTemplateOutlet="fenleiListT; context: {$implicit: fenleisNotSelected, class: 'not-selected'}"></ng-template>
      </div>

      <ng-template #fenleiListT [appTypedTemplate]="fenleiListDataType" let-fenleis let-class="class">
        <mat-selection-list
          #fenleiList
          [class]="class"
          class="list flex-110"
          [multiple]="false"
          cdkDropList
          [cdkDropListData]="fenleis"
          (cdkDropListDropped)="dropFenlei($event)"
          cdkDropListSortingDisabled
        >
          <mat-list-option
            class="list-item"
            *ngFor="let item of fenleis; let i = index"
            [value]="item.vid"
            cdkDrag
            (click)="class === 'selected' ? deselectFenlei(i) : selectFenlei(i)"
            >{{ item.mingzi }}</mat-list-option
          >
        </mat-selection-list>
      </ng-template>
    </div>
    <div class="daxiaoguanxi flex-column">
      <div class="btn-group">
        <div class="title">模块大小关系</div>
        <button mat-raised-button color="primary" [disabled]="!currRectInfo" (click)="editFormulas()">编辑</button>
      </div>
      <ng-scrollbar>
        <div class="formulas flex-row">
          <div class="formula flex-row" *ngFor="let item of currRectInfo?.raw?.['模块大小关系']| keyvalue">
            <div class="key">{{ item.key }}</div>
            <div class="divider">=</div>
            <div class="value">{{ item.value }}</div>
          </div>
        </div>
      </ng-scrollbar>
    </div>
  </div>
</div>
